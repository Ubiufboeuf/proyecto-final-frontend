---
import { SideBar } from '@/components/SideBar'
import Header from '@/components/Header.astro'
import Footer from '@/components/Footer.astro'
import '../styles/global.css'

interface Props {
	title: string
	class?: string
}

const { title, class: className = '' } = Astro.props
const { originPathname: pathname } = Astro

const themeCookie = Astro.cookies.get('berrutti-web-theme')
---

<html lang='es' data-theme={themeCookie?.value || 'system'}>
	<head>
		<meta charset='utf-8' />
		<link rel='icon' type='image/svg+xml' href='/favicon.webp' />
		<meta name='viewport' content='width=device-width' />
		<meta name='description' content='Web no oficial de Berrutti Turismo. Proyecto de fin de aÃ±o' />
		<title>{title ? `${title} - Berrutti Turismo` : title}</title>
		<script>
			(function() {
				let deviceType = localStorage.getItem('deviceType')
				if (deviceType) {
					document.body.classList.add(deviceType)
					return
				}
				
				const ua = navigator.userAgent
				const mobileRegex = /(Mobi|Android(?!.*Nexus 7)|iPhone|iPod|Windows Phone|BlackBerry|Symbian|IEMobile|Opera Mini|Fennec|webOS|hpwos|avantgo|bada|blazer|compal|elaine|hiptop|kindle|lge|maemo|midp|mmp|netfront|palm|phone|plucker|pocket|psp|series60|treo|up\.browser|up\.link|vodafone|wap|windows ce|xda|xiino)/i
				
				if (mobileRegex.test(ua) && !/iPad/i.test(ua)) {
					deviceType = 'is-mobile-ua'
				} else {
					deviceType = 'is-laptop-ua'
				}

				document.body.classList.add(deviceType)
				localStorage.setItem('deviceType', deviceType)
			})()
		</script>
		<script>
			(function() {
				const theme = document.cookie
					.split('; ')
					.find(c => c.startsWith('berrutti-web-theme='))
					?.split('=')[1] || 'system'
				document.documentElement.dataset.theme = theme
			})()
		</script>
		<script>
			const $inputGlobalSidebar = document.querySelector('#input-global-sidebar')

			function toggleSidebar (event: Event) {
				const input = event.currentTarget
				if (!(input instanceof HTMLInputElement)) return

				const { checked } = input
				document.documentElement.setAttribute('data-sidebar-open', checked ? 'checked' : '')
			}
			function checkSidebarState () {
				if (!($inputGlobalSidebar instanceof HTMLInputElement)) return
				const { checked } = $inputGlobalSidebar
				document.documentElement.setAttribute('data-sidebar-open', checked ? 'checked' : '')
			}
			
			$inputGlobalSidebar?.addEventListener('input', toggleSidebar)
			window.addEventListener('load', checkSidebarState)
		</script>
	</head>
	<body class='relative bg-linear-to-b dark:bg-radial-[circle_at_50%_20%] from-blue-50 to-orange-50 text-black dark:from-gray-800 dark:to-gray-900'>
		<input id='input-global-sidebar' type='checkbox' hidden />
		<Header pathname={pathname} />
		<SideBar pathname={pathname} client:idle />
		<main class={`flex flex-col items-center ${className}`}>
			<slot />
		</main>
		<Footer />
	</body>
</html>
