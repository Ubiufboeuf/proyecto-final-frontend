---
import { DriverDashboard } from '@/components/DriverDashboard';
import LayoutSimple from '@/layouts/LayoutSimple.astro';
import { SESSION_COOKIE_NAME } from '@/lib/constants';
import { getUserData } from '@/services/userService';

const token = Astro.cookies.get(SESSION_COOKIE_NAME)
if (!token) return Astro.redirect('/')

const user = await getUserData(token.value)

if (!user || (user.role !== 'driver' && user.role !== 'admin')) return Astro.redirect('/')
---

<LayoutSimple title='Conductor'>
  <DriverDashboard user={user} client:load />
</LayoutSimple>